{
    "type": "object",
    "if": {
        "properties": {
            "frequency": {
                "const": "once"
            }
        }
    },
    "then": {
        "required": [
            "date"
        ]
    },
    "else": {
        "not": {
            "required": [
                "date"
            ]
        }
    },
    "required": [
        "protocol",
        "data"
    ],
    "properties": {
        "protocol": {
            "type": "string",
            "enum": [
                "http",
                "ftp",
                "esri"
            ]
        },
        "data": {
            "type": "string",
            "description": "A URL referencing the dataset. This should point to the raw data and not a web portal. If there isn't a good URL for the source, process the file to the desired format, upload it to a third party file hosting service and ask for uploading that file to the cache which then gives you this URL.",
            "minLength": 1
        },
        "website": {
            "type": "string",
            "description": "A URL referencing the data portal.",
            "minLength": 1
        },
        "compression": {
            "type": "string",
            "enum": [
                "zip"
            ]
        },
        "license": {
            "type": "object",
            "if": {
                "required": [
                    "attribution_name"
                ]
            },
            "then": {
                "required": [
                    "attribution"
                ],
                "properties": {
                    "attribution": {
                        "const": true
                    }
                }
            },
            "additionalProperties": false,
            "properties": {
                "url": {
                    "type": "string",
                    "description": "A fully qualified URL to a file (PDF or text document) of the full license of the source.",
                    "minLength": 1
                },
                "text": {
                    "type": "string",
                    "description": "Short description of license terms, e.g. “CC BY 4.0”.",
                    "minLength": 1
                },
                "attribution": {
                    "type": "boolean",
                    "description": "Is attribution to the copyright holder required? true if other attribution details are present, otherwise false."
                },
                "attribution_name": {
                    "type": "string",
                    "description": "Name of data copyright holder requiring attribution, e.g. “United Federation of Planets”.",
                    "minLength": 1
                },
                "share-alike": {
                    "type": "boolean",
                    "description": "Must derivative works be licensed under the same or compatible terms as the original work?"
                }
            }
        },
        "contact": {
            "type": "object",
            "description": "Contact information for the dataset or provider.",
            "additionalProperties": false,
            "properties": {
                "name": {
                    "type": "string",
                    "description": "Full name of a specific contact person.",
                    "minLength": 1
                },
                "title": {
                    "type": "string",
                    "description": "Title for the contact person, e.g. “GIS Coordinator“.",
                    "minLength": 1
                },
                "phone": {
                    "type": "string",
                    "minLength": 1
                },
                "email": {
                    "type": "string",
                    "pattern": "/^\\S+@\\S+\\.\\S+$/"
                },
                "address": {
                    "type": "string",
                    "description": "Mailing address for the dataset provider.",
                    "minLength": 1
                }
            }
        },
        "note": {
            "description": "A human readable note about this layer.",
            "oneOf": [
                {
                    "type": "string",
                    "minLength": 1
                },
                {
                    "type": "object"
                }
            ]
        },
        "language": {
            "type": "string",
            "description": "ISO 639-3 language code for the data.",
            "pattern": "^[a-z]{3}$"
        },
        "date": {
            "type": "object",
            "description": "If frequency=once, the date of the data.",
            "additionalProperties": false,
            "required": [
                "year"
            ],
            "properties": {
                "year": {
                    "type": "string",
                    "pattern": "^\\d{4}$"
                },
                "month": {
                    "type": "string",
                    "pattern": "^(0?[1-9]|1[012])$"
                },
                "day": {
                    "type": "string",
                    "pattern": "^(0[1-9]|[12][0-9]|3[01])$"
                }
            }
        },
        "skip": {
            "type": "boolean",
            "description": "Skip running this source.",
            "default": "false"
        },
        "frequency": {
            "type": "string",
            "description": "Frequency at which the source should be re-run.",
            "default": "weekly",
            "enum": [
                "once",
                "weekly",
                "monthly"
            ]
        },
        "test": {
            "type": "object",
            "required": [
                "description",
                "acceptance-tests"
            ],
            "additionalProperties": false,
            "properties": {
                "enabled": {
                    "type": "boolean"
                },
                "description": {
                    "type": "string",
                    "minLength": 1
                },
                "acceptance-tests": {
                    "type": "array",
                    "minItems": 1,
                    "items": {
                        "type": "object",
                        "required": [
                            "description",
                            "inputs",
                            "expected"
                        ],
                        "additionalProperties": false,
                        "properties": {
                            "description": {
                                "type": "string",
                                "minLength": 1
                            },
                            "inputs": {
                                "type": "object"
                            },
                            "expected": {
                                "type": "object"
                            }
                        }
                    }
                }
            }
        }
    }
}
